﻿@{
    ViewData["Title"] = "Dashboard";
}
<div class="row">
    <div class="container-fluid">
        <div class="col-md-12">
            <h5>Thống kê số lượng</h5>


            </ul>
            <ul class="total-of-all">
                <li>Tổng sản phẩm: @ViewBag.CountProduct</li>
                <li>Tổng danh mục sản phẩm: @ViewBag.CountCategory</li>
                <li>Tổng đơn hàng: @ViewBag.CountProduct</li>
                <li>Tổng khách hàng: @ViewBag.CountUser</li>
            </ul>
        </div>

        @* <div id="myfirstchart" style="height: 250px;"></div> *@
        <canvas id="userChart" width="400" height="200"></canvas>
    </div>
</div>
</div>
@section Scripts {
    @* Chartjs *@
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    @* Sử dụng biểu đồ để show *@
    <script>
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "/admin/dashboard/get-user-chart-data",
                success: function (data) {
                    console.log("Dữ liệu trả về từ API:", data);
                    if (!Array.isArray(data)) {
                        console.error("Dữ liệu không phải là mảng:", data);
                        return;
                    }

                    const labels = data.map(item => item.date);
                    const counts = data.map(item => item.count);

                    new Chart(document.getElementById("userChart"), {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Số lượng đăng ký',
                                data: counts,
                                borderColor: 'blue',
                                fill: false
                            }]
                        }
                    });
                },
                error: function (xhr) {
                    console.error("Lỗi khi gọi API:", xhr.responseText);
                }
            });
        });
    </script>
}
